<!DOCTYPE html>
<html>
<head>
    {% include 'includes/head.html' %}
	<title>MeetUp</title>
	<meta name='description' content='TODO: write descriptions'>
</head>
<body>
    {% include 'includes/header.html' %}
    <main class='body' data-currentPage='{{ startPage }}'>
        <div id='bodyFlash' class='bodyFlash'>
            {% with messages = get_flashed_messages() %}
                {% if messages %}
                    {% for message in messages%}
                        {% if message|first == '|' %}
                            <div>{{ message|replace('|', '') }}</div>
                        {% endif %}
                    {% endfor %}
                {% endif %}
            {% endwith %}
        </div>
        <div id='bodyError' class='bodyFlash'>
            {% with messages = get_flashed_messages() %}
                {% if messages %}
                    {% for message in messages%}
                        {% if message|first == '-' %}
                            <div>{{ message|replace('-', '') }}</div>
                        {% endif %}
                    {% endfor %}
                {% endif %}
            {% endwith %}
        </div>
        <div id='createEventPage' class='page hidden'>
            <form class='eventUI' name='event' method='POST' action='{{ url_for("createEvent") }}'>
                {{ eform.hidden_tag() }}
                <div class='line'>
                    {{ eform.eventName(placeholder=eventPlaceholder) }}
                </div>
                <div class='line'>
                    {{ eform.dates() }}
                    <div class='mdp active' id='mdp'></div>
                </div>
                <div class='line border'>
                    {{ eform.startTime() }}—{{ eform.endTime(minTime='') }}
                </div>
                <button type='submit' class='button'>Create Event</button>
            </form>
        </div>
        <div id='viewEventPage' class='page hidden'>
            <div class='col br'>
                <div class='eventUI'>
                    <input type='hidden' id='eventDates' value='{{ event.dates }}'>
                    <div class='line'>
                        {{ event.name }}
                    </div>
                    <div class='mdp inactive'></div>
                    <div class='line border nb'>
                        {{ event.start }}—{{ event.end }}
                    </div>
                    <a class='pageTurn button' data-target='invitePage'>Invite Members</a>
                    <a class='pageTurn button' data-target='editEventSchedulePage'>Edit your Schedule</a>
                </div>
            </div>
            <div class='col lb'>
                <table id="select-times">
                    <tr class="days">
                        <td class="day"></td>
                        {% for i in range(schedule.days| length) %}
                            <td class="day">{{ schedule.days[i] }} {{ schedule.dates[i] }}</td>
                        {% endfor %}
                    </tr>
                    {% for time in schedule.times %}
                        <tr>
                            <td class="time">{{ time }}</td>
                            {% for date in schedule.dates %}
                                <td style="width: 100px; border: 1px solid black; background-color: {{ event.overlap_colors[ date ~ ' ' ~ time] }};"></td>
                            {% endfor %}
                        </tr>
                    {% endfor %}
                </table>
            </div>
        </div>
        <div id='invitePage' class='page hidden'>
            <form method='POST' action='{{ '/invite/'+event.event_id|string }}'>
                {{ iform.hidden_tag() }}
                <div class='line'>{{ iform.email.label }}{{ iform.email() }}</div><br>
                <button class='button fSubmit'>Invite to Event</button>
            </form>
        </div>
        <div id='editEventSchedulePage' class='page hidden'>
            <div class='tableContainer select-times'>
                {% for date in schedule.dates %}
                    <div class='dayCol'>
                        <div class='dayTitle'>{{ schedule.days[i] }}{{ date }}</div>
                        {% for time in schedule.times %}
                            <div id='{{ date ~ " " ~ time }}' class='timeRow selected'>{{ time }}</div>
                        {% endfor %}
                    </div>
{#                    <td class="day">{{ schedule.days[i] }} {{ schedule.dates[i] }}</td>#}
                {% endfor %}
            </div>
            <form id='eSchedule' name='schedule' method='POST' action='{{ url_for("setSchedule", eventId=event.event_id) }}'>
                {{ aform.hidden_tag() }}
                {{ aform.availability() }}
                {% if current_user.is_authenticated %}
                    {{ aform.user_name(type='hidden', value=current_user.username) }}
                {% else %}
                    <div class='line'>{{ aform.user_name.label }}{{ aform.user_name() }}</div><br>
                {% endif %}
                <button id='esSubmit' type='submit' class='button'>Set Schedule</button>
            </form>
        </div>
        <div id='psPage' class='page hidden'>
            <div class='tableContainer'>
{#            <form id='' name='personalSchedule' method='POST' action='{{  }}'>#}
{#                <button id='esSubmit' type='submit' class='button'>Set Schedule</button>#}
{#            </form>#}
            </div>
        </div>
        <div class='sidebar'>
            <div class='sidebarContent'>
                <div class='account'>
                    <i class='faButton fas fa-user-circle'></i>
                    <div class='uname'>{% if user.is_authenticated %}{{ user.username }}{% endif %}</div>
                    <div class='close faButton'><i class="fas fa-times"></i></div>
                </div>
                {% if user.is_authenticated %}
                    <a class='pageTurn button' data-target='psPage'>My Schedule</a>
                    <h3>Events</h3>
                    {% for event in userEvents%}
                        <a class='eventLink sl' href="{{ url_for('event', eventId=event.event_id) }}">{{event.name}}</a>
                    {% endfor %}
                    <a class='pageTurn button' data-target='createEventPage'>Create a New Event</a>
                    <a class='button' href="{{ url_for('logout') }}">Log Out</a>
                {% else %}
                    <h2>Your Account</h2>
                    <form name='loginForm' method='POST' action='{{ url_for("login") }}'>
                        {{ lform.hidden_tag() }}
                        <div class='line'>{{ lform.username.label }}{{ lform.username() }}</div><br>
                        <div class='line'>{{ lform.password.label }}{{ lform.password() }}</div><br>
                        <div class='line'>{{ lform.remember.label }}<label class='check'>{{ lform.remember() }}<span class='checkmark'></span></label></div><br>
                        <button class='button fSubmit'>Login</button>
                    </form>
                    <a id='pwReset' class='sl'>Forgot Password</a>
                    <div id='pwrDiv' style='display:none'>
                        <form method='POST' action='{{ url_for("reset_request") }}'>
                            {{ pform.hidden_tag() }}
                            <div class='line'>{{ pform.email.label }}{{ pform.email() }}</div><br>
                            <button class='button fSubmit'>Request Reset</button>
                        </form>
                    </div>
                    <h4>OR</h4>
                    <form name='signupForm' method='POST' action='{{ url_for("signup") }}'>
                        {{ sform.hidden_tag() }}
                        <div class='line'>{{ sform.email.label }}{{ sform.email() }}</div><br>
                        <div class='line'>{{ sform.username.label }}{{ sform.username() }}</div><br>
                        <div class='line'>{{ sform.password.label }}{{ sform.password() }}</div><br>
                        <div class='line'>{{ sform.password2.label }}{{ sform.password2() }}</div><br>
                        {{ sform.recaptcha }}
                        <button class='button fSubmit'>Sign Up</button>
                    </form>
                {% endif %}
            </div>
            <div class='sidebarFlash'>
                {% with messages = get_flashed_messages() %}
                    {% if messages %}
                        {% for message in messages%}
                            {% if message|first == '~' %}
                                <div>{{ message|replace('~', '') }}</div>
                            {% endif %}
                        {% endfor %}
                    {% endif %}
                {% endwith %}
            </div>
            <div class='sidebarError'>
                {% with messages = get_flashed_messages() %}
                    {% if messages %}
                        {% for message in messages%}
                            {% if message|first == '`' %}
                                <div>{{ message|replace('`', '') }}</div>
                            {% endif %}
                        {% endfor %}
                    {% endif %}
                {% endwith %}
            </div>
        </div>
    </main>
    {% include 'includes/footer.html' %}
</body>
</html>